{"version":3,"file":"index.cjs","sources":["../src/index.ts"],"sourcesContent":["export type StripCommentsPlugin = {\n  name: string;\n  enforce: \"pre\" | \"post\";\n  transform: (\n    code: string,\n    id?: string,\n  ) => string;\n};\n\nexport type StripCommentsConfig = {\n  type: \"none\" | \"keep-legal\" | \"istanbul\";\n  enforce: \"pre\" | \"post\";\n};\n\nconst StripCommentsDefaultConfig: StripCommentsConfig = {\n  type: \"istanbul\",\n  enforce: \"pre\",\n};\n\nconst stripComments = (cfg: Partial<StripCommentsConfig> = {}) => {\n  const config: Partial<StripCommentsConfig> = {};\n  config.type = [\"none\", \"keep-legal\", \"istanbul\"].some((x) => x === cfg.type)\n    ? cfg.type as StripCommentsConfig[\"type\"]\n    : StripCommentsDefaultConfig.type;\n  config.enforce = [\"pre\", \"post\"].some((x) => x === cfg.enforce)\n    ? cfg.enforce as StripCommentsConfig[\"enforce\"]\n    : StripCommentsDefaultConfig.enforce;\n\n  return {\n    name: \"vite-plugin-strip-comments\",\n    enforce: config.enforce,\n    transform(code: string, id?: string) {\n      /* istanbul ignore if @preserve */\n      if (!id || id.includes(\"node_modules\")) return code;\n      let result = code;\n\n      const matches = code.matchAll(\n        /\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/gm,\n      );\n      const matchesArray = Array.from(matches);\n      let match: string;\n\n      for (let i = 0; i < matchesArray.length; i += 1) {\n        // capture first match\n        [match] = matchesArray[i];\n\n        switch (config.type) {\n          case \"keep-legal\":\n            if (![\"@legal\", \"@license\"].some((x) => match.includes(x))) {\n              result = result.replaceAll(match, \"\");\n            }\n            break;\n          case \"istanbul\":\n            if (match.includes(\"istanbul\")) {\n              /* istanbul ignore next @preserve */\n              result = result.replaceAll(match, \"\");\n            }\n            break;\n          case \"none\":\n          default:\n            result = result.replaceAll(match, \"\");\n        }\n      }\n\n      return result;\n    },\n  } satisfies StripCommentsPlugin;\n};\n\nexport default stripComments;\n"],"names":["StripCommentsDefaultConfig","stripComments","cfg","config","x","code","id","result","matches","matchesArray","match","i"],"mappings":"aAcA,MAAMA,EAAkD,CACtD,KAAM,WACN,QAAS,KACX,EAEMC,EAAgB,CAACC,EAAoC,KAAO,CAChE,MAAMC,EAAuC,CAAC,EAC9C,OAAAA,EAAO,KAAO,CAAC,OAAQ,aAAc,UAAU,EAAE,KAAMC,GAAMA,IAAMF,EAAI,IAAI,EACvEA,EAAI,KACJF,EAA2B,KAC/BG,EAAO,QAAU,CAAC,MAAO,MAAM,EAAE,KAAMC,GAAMA,IAAMF,EAAI,OAAO,EAC1DA,EAAI,QACJF,EAA2B,QAExB,CACL,KAAM,6BACN,QAASG,EAAO,QAChB,UAAUE,EAAcC,EAAa,CAEnC,GAAI,CAACA,GAAMA,EAAG,SAAS,cAAc,EAAU,OAAAD,EAC/C,IAAIE,EAASF,EAEb,MAAMG,EAAUH,EAAK,SACnB,2BACF,EACMI,EAAe,MAAM,KAAKD,CAAO,EACnC,IAAAE,EAEJ,QAASC,EAAI,EAAGA,EAAIF,EAAa,OAAQE,GAAK,EAI5C,OAFC,CAAAD,CAAK,EAAID,EAAaE,CAAC,EAEhBR,EAAO,KAAM,CACnB,IAAK,aACE,CAAC,SAAU,UAAU,EAAE,KAAMC,GAAMM,EAAM,SAASN,CAAC,CAAC,IAC9CG,EAAAA,EAAO,WAAWG,EAAO,EAAE,GAEtC,MACF,IAAK,WACCA,EAAM,SAAS,UAAU,IAElBH,EAAAA,EAAO,WAAWG,EAAO,EAAE,GAEtC,MACF,IAAK,OACL,QACWH,EAAAA,EAAO,WAAWG,EAAO,EAAE,CAAA,CAInC,OAAAH,CAAA,CAEX,CACF"}